<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Battery Manager â€” README</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <input class="docs-toggle" type="radio" name="lang" id="lang-fr" checked />
  <input class="docs-toggle" type="radio" name="lang" id="lang-en" />

  <input class="docs-toggle" type="radio" name="theme" id="theme-auto" checked />
  <input class="docs-toggle" type="radio" name="theme" id="theme-light" />
  <input class="docs-toggle" type="radio" name="theme" id="theme-dark" />

  <div class="app">
    <div class="layout">
      <aside class="sidebar" aria-label="Documentation navigation">
        <div class="brand">
          <img src="icon.png" alt="Battery Manager" />
          <div>
            <div class="title">Battery Manager</div>
            <div class="subtitle">Docs â€¢ menu â€¢ FR/EN â€¢ thÃ¨me</div>
          </div>
        </div>

        <div class="controls">
          <div class="control-group">
            <div class="label">Langue / Language</div>
            <div class="pills" role="group" aria-label="Language">
              <label class="pill" for="lang-fr">FR</label>
              <label class="pill" for="lang-en">EN</label>
            </div>
          </div>

          <div class="control-group">
            <div class="label">ThÃ¨me / Theme</div>
            <div class="pills" role="group" aria-label="Theme">
              <label class="pill" for="theme-auto">Auto</label>
              <label class="pill" for="theme-light">Clair</label>
              <label class="pill" for="theme-dark">Sombre</label>
            </div>
          </div>
        </div>

        <nav class="nav" aria-label="Pages">
          <div class="nav-title">Pages</div>
          <a href="README.html" aria-current="page">README</a>
<a href="REFERENCES.html">References</a>

          <div class="nav-title">Sommaire</div>
          <div class="toc-fr"><div class="toc">
<ul>
<li><a href="#battery-manager">Battery Manager</a><ul>
<li><a href="#fonctionnalites">âœ¨ FonctionnalitÃ©s</a><ul>
<li><a href="#gestion-de-batterie">ğŸ”‹ Gestion de batterie</a></li>
<li><a href="#internationalisation">ğŸŒ Internationalisation</a></li>
<li><a href="#themes">ğŸ¨ ThÃ¨mes</a></li>
<li><a href="#architecture">ğŸ—ï¸ Architecture</a></li>
</ul>
</li>
<li><a href="#description">ğŸ“ Description</a><ul>
<li><a href="#ce-que-fait-cette-application">Ce que fait cette application</a></li>
</ul>
</li>
<li><a href="#installation">ğŸ“¦ Installation</a><ul>
<li><a href="#pour-les-utilisateurs-recommande">Pour les utilisateurs (recommandÃ©)</a></li>
<li><a href="#pour-les-developpeurs">Pour les dÃ©veloppeurs</a></li>
</ul>
</li>
<li><a href="#utilisation">ğŸš€ Utilisation</a><ul>
<li><a href="#interface">Interface</a></li>
</ul>
</li>
<li><a href="#scripts-et-fonctionnement-important">ğŸ§© Scripts et fonctionnement (important)</a><ul>
<li><a href="#1-ou-sont-stockes-les-seuils">1) OÃ¹ sont stockÃ©s les seuils ?</a></li>
<li><a href="#2-comment-les-seuils-sont-restaures-au-boot">2) Comment les seuils sont restaurÃ©s au boot ?</a></li>
<li><a href="#3-a-quoi-servent-les-scripts-dans-install">3) Ã€ quoi servent les scripts dans install/ ?</a></li>
</ul>
</li>
<li><a href="#desinstallation">ğŸ—‘ï¸ DÃ©sinstallation</a></li>
<li><a href="#structure-du-projet">ğŸ“‚ Structure du projet</a><ul>
<li><a href="#statistiques-du-code">Statistiques du code</a></li>
<li><a href="#fichiers-de-configuration-systeme">Fichiers de configuration systÃ¨me</a></li>
<li><a href="#fichiers-de-configuration-utilisateur">Fichiers de configuration utilisateur</a></li>
</ul>
</li>
<li><a href="#prerequis">ğŸ”§ PrÃ©requis</a><ul>
<li><a href="#pour-les-utilisateurs-finaux">Pour les utilisateurs finaux</a></li>
<li><a href="#pour-les-developpeurs_1">Pour les dÃ©veloppeurs</a></li>
</ul>
</li>
<li><a href="#compatibilite">âœ… CompatibilitÃ©</a><ul>
<li><a href="#chemins-supportes">Chemins supportÃ©s</a></li>
<li><a href="#verification-de-compatibilite">VÃ©rification de compatibilitÃ©</a></li>
</ul>
</li>
<li><a href="#limitations">âš ï¸ Limitations</a></li>
<li><a href="#tests">ğŸ§ª Tests</a><ul>
<li><a href="#couverture-des-tests">Couverture des tests</a></li>
</ul>
</li>
<li><a href="#documentation">ğŸ“š Documentation</a></li>
<li><a href="#qualite-aaa">ğŸ† QualitÃ© AAA</a><ul>
<li><a href="#analyse-statique">Analyse statique</a></li>
<li><a href="#metriques-de-qualite">MÃ©triques de qualitÃ©</a></li>
<li><a href="#optimisations-appliquees">Optimisations appliquÃ©es</a></li>
</ul>
</li>
<li><a href="#licence">ğŸ“„ Licence</a></li>
<li><a href="#contribution">ğŸ¤ Contribution</a><ul>
<li><a href="#guidelines">Guidelines</a></li>
</ul>
</li>
<li><a href="#support">ğŸ“ Support</a></li>
</ul>
</li>
</ul>
</div>
</div>
          <div class="toc-en"><div class="toc">
<ul>
<li><a href="#battery-manager">Battery Manager</a><ul>
<li><a href="#features">âœ¨ Features</a><ul>
<li><a href="#battery-management">ğŸ”‹ Battery management</a></li>
<li><a href="#internationalization">ğŸŒ Internationalization</a></li>
<li><a href="#themes">ğŸ¨ Themes</a></li>
<li><a href="#architecture">ğŸ—ï¸ Architecture</a></li>
</ul>
</li>
<li><a href="#description">ğŸ“ Description</a><ul>
<li><a href="#what-this-app-does">What this app does</a></li>
</ul>
</li>
<li><a href="#installation">ğŸ“¦ Installation</a><ul>
<li><a href="#end-users-recommended">End users (recommended)</a></li>
<li><a href="#developers">Developers</a></li>
</ul>
</li>
<li><a href="#usage">ğŸš€ Usage</a><ul>
<li><a href="#ui">UI</a></li>
</ul>
</li>
<li><a href="#scripts-behavior-important">ğŸ§© Scripts &amp; behavior (important)</a><ul>
<li><a href="#1-where-are-thresholds-stored">1) Where are thresholds stored?</a></li>
<li><a href="#2-how-are-thresholds-restored-at-boot">2) How are thresholds restored at boot?</a></li>
<li><a href="#3-what-are-the-scripts-in-install">3) What are the scripts in install/?</a></li>
</ul>
</li>
<li><a href="#uninstall">ğŸ—‘ï¸ Uninstall</a></li>
<li><a href="#project-structure">ğŸ“‚ Project structure</a><ul>
<li><a href="#code-stats">Code stats</a></li>
</ul>
</li>
<li><a href="#requirements">ğŸ”§ Requirements</a><ul>
<li><a href="#end-users">End users</a></li>
<li><a href="#developers_1">Developers</a></li>
</ul>
</li>
<li><a href="#compatibility">âœ… Compatibility</a></li>
<li><a href="#limitations">âš ï¸ Limitations</a></li>
<li><a href="#tests">ğŸ§ª Tests</a></li>
<li><a href="#aaa-quality">ğŸ† AAA Quality</a></li>
<li><a href="#license">ğŸ“„ License</a></li>
</ul>
</li>
</ul>
</div>
</div>
        </nav>
      </aside>

      <main class="content">
        <div class="lang lang-fr"><h1 id="battery-manager">Battery Manager<a class="headerlink" href="#battery-manager" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Gestionnaire de seuils de charge pour batteries Linux avec interface GTK4</p>
</blockquote>
<p><img alt="Battery Manager" src="icon.png" /></p>
<p><a href="https://www.rust-lang.org/"><img alt="Rust" src="https://img.shields.io/badge/Rust-1.92.0-orange.svg" /></a>
<a href="https://gtk.org/"><img alt="GTK4" src="https://img.shields.io/badge/GTK-4.0-blue.svg" /></a>
<a href="LICENSE"><img alt="License" src="https://img.shields.io/badge/License-MIT-green.svg" /></a>
<a href="#tests"><img alt="Tests" src="https://img.shields.io/badge/Tests-40%2F40_passing-success.svg" /></a>
<a href="#qualit%C3%A9-aaa"><img alt="Quality" src="https://img.shields.io/badge/Clippy-0_warnings-success.svg" /></a>
<a href="#structure-du-projet"><img alt="Code" src="https://img.shields.io/badge/Lines-3473_Rust-blueviolet.svg" /></a></p>
<hr />
<h2 id="fonctionnalites">âœ¨ FonctionnalitÃ©s<a class="headerlink" href="#fonctionnalites" title="Permanent link">&para;</a></h2>
<h3 id="gestion-de-batterie">ğŸ”‹ Gestion de batterie<a class="headerlink" href="#gestion-de-batterie" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Visualisation en temps rÃ©el</strong> : charge, santÃ©, voltage, puissance, cycles</li>
<li><strong>Configuration des seuils</strong> : dÃ©but et fin de charge (0-100%)</li>
<li><strong>Persistance optionnelle</strong> : restauration au dÃ©marrage via systemd (si activÃ©)</li>
<li><strong>Support multi-fabricants</strong> : ASUS, Lenovo, Dell, Huawei, Samsung, System76, Tuxedo</li>
</ul>
<h3 id="internationalisation">ğŸŒ Internationalisation<a class="headerlink" href="#internationalisation" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Bilingue</strong> : FranÃ§ais et Anglais (80+ clÃ©s de traduction)</li>
<li><strong>DÃ©tection automatique</strong> : basÃ©e sur la langue systÃ¨me (<code>$LANG</code>)</li>
<li><strong>Switch en temps rÃ©el</strong> : changement de langue dans l'interface</li>
<li><strong>Configuration persistante</strong> : <code>~/.config/battery-manager/language.conf</code></li>
</ul>
<h3 id="themes">ğŸ¨ ThÃ¨mes<a class="headerlink" href="#themes" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ThÃ¨me clair</strong> : nuances de gris (#f6f5f4 - #ffffff)</li>
<li><strong>ThÃ¨me sombre</strong> : nuances de gris (#252525 - #424242)</li>
<li><strong>Application instantanÃ©e</strong> : changement de thÃ¨me sans redÃ©marrage</li>
<li><strong>Configuration persistante</strong> : <code>~/.config/battery-manager/theme.conf</code></li>
<li><strong>Design confortable</strong> : sans blanc/noir pur pour le confort visuel</li>
</ul>
<h3 id="architecture">ğŸ—ï¸ Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>SOLID</strong> : sÃ©paration stricte core/ (logique) et ui/ (prÃ©sentation)</li>
<li><strong>40 tests unitaires</strong> : 100% de rÃ©ussite</li>
<li><strong>Documentation complÃ¨te</strong> : docstrings Rust standard</li>
<li><strong>QualitÃ© AAA</strong> : 0 warning Clippy (pedantic + nursery)</li>
</ul>
<hr />
<h2 id="description">ğŸ“ Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Application simple permettant de visualiser les informations de batterie et de configurer les seuils de charge sur les ordinateurs portables Linux compatibles.</p>
<p><strong>Technologies</strong> : Ã‰crit en Rust avec GTK4, utilise l'interface sysfs du noyau Linux pour lire et modifier les paramÃ¨tres de charge.</p>
<h3 id="ce-que-fait-cette-application">Ce que fait cette application<a class="headerlink" href="#ce-que-fait-cette-application" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… Affiche les informations de base de la batterie (charge, Ã©tat, santÃ©, cycles)</li>
<li>âœ… Permet de dÃ©finir des seuils de dÃ©but et fin de charge (prolonge la durÃ©e de vie de la batterie)</li>
<li>âœ… Sauvegarde les seuils dans <code>/etc/battery-manager/BAT*.conf</code> (format texte simple)</li>
<li>âœ… Restaure les seuils au dÃ©marrage via un service systemd</li>
<li>âœ… Ã‰crit directement dans <code>/sys/class/power_supply/</code> (nÃ©cessite pkexec)</li>
<li>âœ… DÃ©tecte les batteries de pÃ©riphÃ©riques (souris/clavier sans fil)</li>
</ul>
<hr />
<h2 id="installation">ğŸ“¦ Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="pour-les-utilisateurs-recommande">Pour les utilisateurs (recommandÃ©)<a class="headerlink" href="#pour-les-utilisateurs-recommande" title="Permanent link">&para;</a></h3>
<p>Installation complÃ¨te avec icÃ´ne, raccourci menu et service systemd :</p>
<pre><code class="language-bash"># TÃ©lÃ©charger le .deb depuis les releases GitHub
sudo dpkg -i battery-manager_0.9.8_amd64.deb
</code></pre>
<p><strong>Le package .deb installe automatiquement :</strong></p>
<ul>
<li>âœ… Le binaire exÃ©cutable (<code>/usr/bin/battery-manager</code>)</li>
<li>âœ… L'icÃ´ne et le raccourci dans le menu applications</li>
<li>âœ… Le service systemd (restauration auto au dÃ©marrage)</li>
<li>âœ… Toutes les dÃ©pendances GTK4 nÃ©cessaires</li>
</ul>
<h3 id="pour-les-developpeurs">Pour les dÃ©veloppeurs<a class="headerlink" href="#pour-les-developpeurs" title="Permanent link">&para;</a></h3>
<p>Installation manuelle du service uniquement (sans raccourci menu) :</p>
<pre><code class="language-bash">git clone https://github.com/weedmanu/Battery_Charge_Manager.git
cd Battery_Manager
cargo build --release
cd install
sudo ./install.sh      # Installe uniquement le service systemd
</code></pre>
<blockquote>
<p><strong>Note</strong> : <code>install.sh</code> est conÃ§u pour le dÃ©veloppement. Il n'installe PAS le raccourci menu ni l'icÃ´ne. Pour une installation complÃ¨te utilisateur, utilisez le package <code>.deb</code>.</p>
</blockquote>
<hr />
<h2 id="utilisation">ğŸš€ Utilisation<a class="headerlink" href="#utilisation" title="Permanent link">&para;</a></h2>
<p>Lancer l'application depuis le menu ou en terminal :</p>
<pre><code class="language-bash">battery-manager                # Lance avec langue systÃ¨me
battery-manager --lang=fr      # Force le franÃ§ais
battery-manager --lang=en      # Force l'anglais
battery-manager --debug        # Active les logs de debug
battery-manager --help         # Affiche l'aide complÃ¨te

# Forcer/dÃ©sactiver les couleurs des logs (optionnel)
BATTERY_MANAGER_COLOR=always battery-manager --debug
NO_COLOR=1 battery-manager --debug
</code></pre>
<h3 id="interface">Interface<a class="headerlink" href="#interface" title="Permanent link">&para;</a></h3>
<p>L'interface comporte <strong>4 onglets</strong> :</p>
<ul>
<li><strong>ğŸ“Š Informations</strong> : Ã©tat de la batterie (charge, santÃ©, voltage, puissance, cycles)</li>
<li><strong>ğŸ–±ï¸ PÃ©riphÃ©riques</strong> : batteries externes (souris, clavier sans fil)</li>
<li><strong>âš™ï¸ RÃ©glages</strong> : curseurs pour les seuils de charge, alarme, activation service systemd</li>
<li><strong>ğŸ¨ Interface</strong> : choix de la langue (FR/EN) et du thÃ¨me (clair/sombre)</li>
</ul>
<p>Les seuils sont appliquÃ©s <strong>immÃ©diatement</strong>. Ils sont restaurÃ©s au prochain dÃ©marrage uniquement si le service systemd est activÃ© ; sinon, ils seront perdus aprÃ¨s redÃ©marrage.</p>
<hr />
<h2 id="scripts-et-fonctionnement-important">ğŸ§© Scripts et fonctionnement (important)<a class="headerlink" href="#scripts-et-fonctionnement-important" title="Permanent link">&para;</a></h2>
<h3 id="1-ou-sont-stockes-les-seuils">1) OÃ¹ sont stockÃ©s les seuils ?<a class="headerlink" href="#1-ou-sont-stockes-les-seuils" title="Permanent link">&para;</a></h3>
<p>Les seuils sont sauvegardÃ©s dans des fichiers texte :</p>
<ul>
<li><code>/etc/battery-manager/BAT*.conf</code></li>
</ul>
<p>Format attendu (exemple) :</p>
<pre><code class="language-text">START_THRESHOLD=60
STOP_THRESHOLD=80
</code></pre>
<p>Notes :</p>
<ul>
<li><code>STOP_THRESHOLD</code> est requis.</li>
<li><code>START_THRESHOLD</code> est <strong>optionnel</strong> : certains laptops ne supportent pas un seuil de dÃ©but.</li>
</ul>
<h3 id="2-comment-les-seuils-sont-restaures-au-boot">2) Comment les seuils sont restaurÃ©s au boot ?<a class="headerlink" href="#2-comment-les-seuils-sont-restaures-au-boot" title="Permanent link">&para;</a></h3>
<p>Le service systemd <code>battery-manager.service</code> exÃ©cute un script one-shot :</p>
<ul>
<li><code>/usr/bin/battery-manager-restore</code></li>
</ul>
<p>Ce script lit <code>/etc/battery-manager/*.conf</code> puis tente d'Ã©crire dans sysfs.</p>
<p>Seuil de dÃ©but (si dÃ©fini) :</p>
<ul>
<li><code>/sys/class/power_supply/BAT*/charge_control_start_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_start_threshold</code></li>
</ul>
<p>Seuil de fin :</p>
<ul>
<li><code>/sys/class/power_supply/BAT*/charge_control_end_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_stop_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_end_threshold</code></li>
</ul>
<p>Le script essaie ces chemins dans l'ordre et applique le premier fichier disponible/inscriptible.</p>
<p>Commandes utiles :</p>
<pre><code class="language-bash">systemctl status battery-manager.service
sudo battery-manager-restore
journalctl -u battery-manager.service -b --no-pager
</code></pre>
<h3 id="3-a-quoi-servent-les-scripts-dans-install">3) Ã€ quoi servent les scripts dans <code>install/</code> ?<a class="headerlink" href="#3-a-quoi-servent-les-scripts-dans-install" title="Permanent link">&para;</a></h3>
<ul>
<li><code>install/install.sh</code> : installe <strong>binaire + restore script + service systemd</strong> (mode dev, sans menu/icon)</li>
<li><code>install/uninstall.sh</code> : supprime ces fichiers (conserve <code>/etc/battery-manager/</code>)</li>
<li><code>install/build-deb.sh</code> : construit le package <code>.deb</code> (installation utilisateur complÃ¨te)</li>
</ul>
<hr />
<h2 id="desinstallation">ğŸ—‘ï¸ DÃ©sinstallation<a class="headerlink" href="#desinstallation" title="Permanent link">&para;</a></h2>
<pre><code class="language-bash"># Via .deb
sudo apt remove battery-manager

# Via script manuel
cd Battery_Manager/install
sudo ./uninstall.sh
</code></pre>
<hr />
<h2 id="structure-du-projet">ğŸ“‚ Structure du projet<a class="headerlink" href="#structure-du-projet" title="Permanent link">&para;</a></h2>
<pre><code>Battery_Manager/                        # 7 directories, 35 files
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ docs
â”‚   â”œâ”€â”€ generate_docs.py
â”‚   â”œâ”€â”€ icon.png
â”‚   â”œâ”€â”€ README.html
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ REFERENCES.html
â”‚   â”œâ”€â”€ REFERENCES.md
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ install
â”‚   â”œâ”€â”€ build-deb.sh
â”‚   â”œâ”€â”€ install.sh
â”‚   â””â”€â”€ uninstall.sh
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ resources
â”‚   â”œâ”€â”€ battery-manager.desktop
â”‚   â”œâ”€â”€ battery-manager-restore.sh
â”‚   â”œâ”€â”€ battery-manager.service
â”‚   â””â”€â”€ icon.png
â””â”€â”€ src                                 # Code source Rust (3473 lignes, 17 fichiers)
    â”œâ”€â”€ core
    â”‚   â”œâ”€â”€ battery.rs
    â”‚   â”œâ”€â”€ debug.rs
    â”‚   â”œâ”€â”€ i18n.rs
    â”‚   â”œâ”€â”€ mod.rs
    â”‚   â”œâ”€â”€ peripheral.rs
    â”‚   â”œâ”€â”€ power_supply.rs
    â”‚   â”œâ”€â”€ traits.rs
    â”‚   â””â”€â”€ vendor_detection.rs
    â”œâ”€â”€ main.rs
    â””â”€â”€ ui
        â”œâ”€â”€ app.rs
        â”œâ”€â”€ components.rs
        â”œâ”€â”€ info_tab.rs
        â”œâ”€â”€ mod.rs
        â”œâ”€â”€ peripherals_tab.rs
        â”œâ”€â”€ settings_tab.rs
        â”œâ”€â”€ theme.rs
        â””â”€â”€ ui_tab.rs
</code></pre>
<h3 id="statistiques-du-code">Statistiques du code<a class="headerlink" href="#statistiques-du-code" title="Permanent link">&para;</a></h3>
<pre><code>Language                     files          blank        comment           code
-------------------------------------------------------------------------------
Rust                            17            564            618           3473
-------------------------------------------------------------------------------
</code></pre>
<h3 id="fichiers-de-configuration-systeme">Fichiers de configuration systÃ¨me<a class="headerlink" href="#fichiers-de-configuration-systeme" title="Permanent link">&para;</a></h3>
<p>AprÃ¨s installation, l'application crÃ©e :</p>
<ul>
<li><code>/etc/battery-manager/BAT*.conf</code> : seuils configurÃ©s (<code>START_THRESHOLD=60\nSTOP_THRESHOLD=80</code>)</li>
<li><code>/usr/bin/battery-manager</code> : binaire exÃ©cutable</li>
<li><code>/usr/bin/battery-manager-restore</code> : script de restauration</li>
<li><code>/lib/systemd/system/battery-manager.service</code> : service systemd</li>
<li><code>/usr/share/applications/battery-manager.desktop</code> : lanceur menu</li>
<li><code>/usr/share/pixmaps/battery-manager.png</code> : icÃ´ne</li>
</ul>
<h3 id="fichiers-de-configuration-utilisateur">Fichiers de configuration utilisateur<a class="headerlink" href="#fichiers-de-configuration-utilisateur" title="Permanent link">&para;</a></h3>
<p>L'application sauvegarde les prÃ©fÃ©rences dans <code>~/.config/battery-manager/</code> :</p>
<ul>
<li><code>language.conf</code> : langue choisie (<code>fr</code> ou <code>en</code>)</li>
<li><code>theme.conf</code> : thÃ¨me choisi (<code>light</code> ou <code>dark</code>)</li>
</ul>
<hr />
<h2 id="prerequis">ğŸ”§ PrÃ©requis<a class="headerlink" href="#prerequis" title="Permanent link">&para;</a></h2>
<h3 id="pour-les-utilisateurs-finaux">Pour les utilisateurs finaux<a class="headerlink" href="#pour-les-utilisateurs-finaux" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>OS</strong> : Debian et dÃ©rivÃ©s (Ubuntu, Mint, Pop!_OS, etc.)</li>
<li><strong>GTK4</strong> : installation automatique via le package .deb</li>
<li><strong>pkexec</strong> : PolicyKit (gÃ©nÃ©ralement prÃ©installÃ©)</li>
<li><strong>MatÃ©riel</strong> : ordinateur portable avec support sysfs pour les seuils de charge</li>
</ul>
<h3 id="pour-les-developpeurs_1">Pour les dÃ©veloppeurs<a class="headerlink" href="#pour-les-developpeurs_1" title="Permanent link">&para;</a></h3>
<pre><code class="language-bash"># Outils de dÃ©veloppement Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# DÃ©pendances GTK4
sudo apt install libgtk-4-dev build-essential policykit-1
</code></pre>
<hr />
<h2 id="compatibilite">âœ… CompatibilitÃ©<a class="headerlink" href="#compatibilite" title="Permanent link">&para;</a></h2>
<p>L'application fonctionne sur les ordinateurs portables dont le <strong>noyau Linux expose les fichiers de contrÃ´le de charge</strong> dans <code>/sys/class/power_supply/BAT*/</code>.</p>
<h3 id="chemins-supportes">Chemins supportÃ©s<a class="headerlink" href="#chemins-supportes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>charge_control_start_threshold</code> / <code>charge_control_end_threshold</code> (ASUS, Huawei)</li>
<li><code>charge_start_threshold</code> / <code>charge_stop_threshold</code> (Lenovo, Samsung)</li>
<li><code>charge_end_threshold</code> (Dell, System76)</li>
</ul>
<h3 id="verification-de-compatibilite">VÃ©rification de compatibilitÃ©<a class="headerlink" href="#verification-de-compatibilite" title="Permanent link">&para;</a></h3>
<pre><code class="language-bash"># VÃ©rifier les fichiers disponibles
ls /sys/class/power_supply/BAT0/

# Tester l'Ã©criture (nÃ©cessite root)
echo 80 | sudo tee /sys/class/power_supply/BAT0/charge_control_end_threshold
</code></pre>
<p>Fonctionnera si votre ordinateur portable expose ces fichiers via sysfs.</p>
<hr />
<h2 id="limitations">âš ï¸ Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h2>
<ul>
<li>âŒ NÃ©cessite un support matÃ©riel et noyau appropriÃ©</li>
<li>âŒ Certains fabricants n'exposent qu'un seul seuil (fin de charge uniquement)</li>
<li>âŒ L'application ne peut pas crÃ©er de support lÃ  oÃ¹ le matÃ©riel/noyau ne le fournit pas</li>
<li>âŒ Le changement de langue nÃ©cessite un redÃ©marrage de l'application</li>
</ul>
<hr />
<h2 id="tests">ğŸ§ª Tests<a class="headerlink" href="#tests" title="Permanent link">&para;</a></h2>
<p>L'application dispose de <strong>40 tests unitaires</strong> avec <strong>100% de rÃ©ussite</strong> :</p>
<pre><code class="language-bash">cargo test                    # ExÃ©cuter tous les tests
cargo test --test-threads=1   # ExÃ©cuter en sÃ©quentiel (recommandÃ© pour i18n)

# RÃ©sultat attendu :
# test result: ok. 40 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre>
<h3 id="couverture-des-tests">Couverture des tests<a class="headerlink" href="#couverture-des-tests" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… <strong>Validation des entrÃ©es</strong> : noms de batterie, seuils invalides</li>
<li>âœ… <strong>Calculs</strong> : santÃ©, usure, puissance, conversions (mAh, V, mA, W)</li>
<li>âœ… <strong>DÃ©tection fabricant</strong> : ASUS, Lenovo, Dell, Huawei, Samsung, System76, Tuxedo</li>
<li>âœ… <strong>Internationalisation</strong> : traductions FR/EN, clÃ©s manquantes</li>
<li>âœ… <strong>Traits et mocks</strong> : injection de dÃ©pendances pour les tests</li>
</ul>
<hr />
<h2 id="documentation">ğŸ“š Documentation<a class="headerlink" href="#documentation" title="Permanent link">&para;</a></h2>
<p>GÃ©nÃ©rer la documentation du code :</p>
<pre><code class="language-bash">cargo doc --open              # GÃ©nÃ¨re et ouvre la doc HTML dans le navigateur
</code></pre>
<p>La documentation inclut :</p>
<ul>
<li>âœ… Toutes les fonctions publiques avec docstrings</li>
<li>âœ… Exemples d'utilisation</li>
<li>âœ… Structure des modules</li>
<li>âœ… Graphes de dÃ©pendances</li>
</ul>
<hr />
<h2 id="qualite-aaa">ğŸ† QualitÃ© AAA<a class="headerlink" href="#qualite-aaa" title="Permanent link">&para;</a></h2>
<h3 id="analyse-statique">Analyse statique<a class="headerlink" href="#analyse-statique" title="Permanent link">&para;</a></h3>
<pre><code class="language-bash">cargo fmt                     # Formater le code (style officiel Rust)
cargo clippy --all-features --all-targets -- -W clippy::pedantic -W clippy::nursery
                              # Analyse stricte : 0 warning âœ…

cargo build --release         # Compiler en mode release
</code></pre>
<h3 id="metriques-de-qualite">MÃ©triques de qualitÃ©<a class="headerlink" href="#metriques-de-qualite" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>MÃ©trique</th>
<th>Valeur</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Warnings Clippy</strong></td>
<td>0 / 0</td>
<td>âœ… 100%</td>
</tr>
<tr>
<td><strong>Tests unitaires</strong></td>
<td>40 / 40</td>
<td>âœ… 100%</td>
</tr>
<tr>
<td><strong>Documentation</strong></td>
<td>100%</td>
<td>âœ… ComplÃ¨te</td>
</tr>
<tr>
<td><strong>SÃ©curitÃ©</strong></td>
<td><code>unwrap()</code> limitÃ© aux tests</td>
<td>âœ… Hardened</td>
</tr>
<tr>
<td><strong>Architecture</strong></td>
<td>SOLID</td>
<td>âœ… Clean Code</td>
</tr>
</tbody>
</table>
<h3 id="optimisations-appliquees">Optimisations appliquÃ©es<a class="headerlink" href="#optimisations-appliquees" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… <strong>0 warnings Clippy</strong> (pedantic + nursery)</li>
<li>âœ… <strong>Validation stricte</strong> : noms de batterie, seuils, chemins de fichiers</li>
<li>âœ… <strong>Gestion d'erreurs</strong> : <code>Result&lt;T, E&gt;</code> partout, <code>expect()</code> avec messages descriptifs</li>
<li>âœ… <strong>SÃ©paration des prÃ©occupations</strong> : core/ sans dÃ©pendances GTK</li>
<li>âœ… <strong>Injection de dÃ©pendances</strong> : traits pour testabilitÃ©</li>
<li>âœ… <strong>Code factorisÃ©</strong> : helpers rÃ©utilisables (716 lignes Ã©conomisÃ©es)</li>
</ul>
<hr />
<h2 id="licence">ğŸ“„ Licence<a class="headerlink" href="#licence" title="Permanent link">&para;</a></h2>
<p>MIT - voir <a href="LICENSE">LICENSE</a></p>
<hr />
<h2 id="contribution">ğŸ¤ Contribution<a class="headerlink" href="#contribution" title="Permanent link">&para;</a></h2>
<p>Les contributions sont les bienvenues ! Pour contribuer :</p>
<ol>
<li>Fork le projet</li>
<li>CrÃ©er une branche (<code>git checkout -b feature/amÃ©lioration</code>)</li>
<li>Commit les changements (<code>git commit -m 'Ajout fonctionnalitÃ©'</code>)</li>
<li>Push vers la branche (<code>git push origin feature/amÃ©lioration</code>)</li>
<li>Ouvrir une Pull Request</li>
</ol>
<h3 id="guidelines">Guidelines<a class="headerlink" href="#guidelines" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… Respecter <code>cargo fmt</code> et <code>cargo clippy</code></li>
<li>âœ… Ajouter des tests pour les nouvelles fonctionnalitÃ©s</li>
<li>âœ… Documenter les fonctions publiques</li>
<li>âœ… Mettre Ã  jour le README si nÃ©cessaire</li>
</ul>
<hr />
<h2 id="support">ğŸ“ Support<a class="headerlink" href="#support" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Issues</strong> : <a href="https://github.com/weedmanu/Battery_Charge_Manager/issues">GitHub Issues</a></li>
<li><strong>Discussions</strong> : <a href="https://github.com/weedmanu/Battery_Charge_Manager/discussions">GitHub Discussions</a></li>
</ul>
<hr />
<p><strong>Made with â¤ï¸ in Rust</strong> | Version 0.9.8</p></div>
        <div class="lang lang-en"><h1 id="battery-manager">Battery Manager<a class="headerlink" href="#battery-manager" title="Permanent link">&para;</a></h1>
<blockquote>
<p>Battery charge threshold manager for Linux laptops with a GTK4 UI</p>
</blockquote>
<p><img alt="Battery Manager" src="icon.png" /></p>
<p><a href="https://www.rust-lang.org/"><img alt="Rust" src="https://img.shields.io/badge/Rust-1.92.0-orange.svg" /></a>
<a href="https://gtk.org/"><img alt="GTK4" src="https://img.shields.io/badge/GTK-4.0-blue.svg" /></a>
<a href="LICENSE"><img alt="License" src="https://img.shields.io/badge/License-MIT-green.svg" /></a>
<a href="#tests"><img alt="Tests" src="https://img.shields.io/badge/Tests-40%2F40_passing-success.svg" /></a>
<a href="#aaa-quality"><img alt="Quality" src="https://img.shields.io/badge/Clippy-0_warnings-success.svg" /></a>
<a href="#project-structure"><img alt="Code" src="https://img.shields.io/badge/Lines-3473_Rust-blueviolet.svg" /></a></p>
<hr />
<h2 id="features">âœ¨ Features<a class="headerlink" href="#features" title="Permanent link">&para;</a></h2>
<h3 id="battery-management">ğŸ”‹ Battery management<a class="headerlink" href="#battery-management" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Real-time view</strong>: charge, health, voltage, power, cycles</li>
<li><strong>Threshold configuration</strong>: start/stop charge (0-100%)</li>
<li><strong>Optional persistence</strong>: restored at boot via systemd (if enabled)</li>
<li><strong>Multi-vendor support</strong>: ASUS, Lenovo, Dell, Huawei, Samsung, System76, Tuxedo</li>
</ul>
<h3 id="internationalization">ğŸŒ Internationalization<a class="headerlink" href="#internationalization" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Bilingual</strong>: French + English (80+ translation keys)</li>
<li><strong>Auto-detect</strong>: based on system language (<code>$LANG</code>)</li>
<li><strong>Live switch</strong>: change language from the UI</li>
<li><strong>Persistent config</strong>: <code>~/.config/battery-manager/language.conf</code></li>
</ul>
<h3 id="themes">ğŸ¨ Themes<a class="headerlink" href="#themes" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Light theme</strong>: gray palette (#f6f5f4 - #ffffff)</li>
<li><strong>Dark theme</strong>: gray palette (#252525 - #424242)</li>
<li><strong>Instant apply</strong>: no restart required</li>
<li><strong>Persistent config</strong>: <code>~/.config/battery-manager/theme.conf</code></li>
<li><strong>Eye-friendly</strong>: avoids pure white/black</li>
</ul>
<h3 id="architecture">ğŸ—ï¸ Architecture<a class="headerlink" href="#architecture" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>SOLID</strong>: strict separation between core/ (logic) and ui/ (presentation)</li>
<li><strong>40 unit tests</strong>: 100% passing</li>
<li><strong>Complete docs</strong>: standard Rust docstrings</li>
<li><strong>AAA quality</strong>: 0 Clippy warnings (pedantic + nursery)</li>
</ul>
<hr />
<h2 id="description">ğŸ“ Description<a class="headerlink" href="#description" title="Permanent link">&para;</a></h2>
<p>Simple desktop app to view battery information and configure charge thresholds on supported Linux laptops.</p>
<p><strong>Tech</strong>: written in Rust + GTK4, uses Linux sysfs to read/write charging parameters.</p>
<h3 id="what-this-app-does">What this app does<a class="headerlink" href="#what-this-app-does" title="Permanent link">&para;</a></h3>
<ul>
<li>âœ… Displays key battery info (charge, status, health, cycles)</li>
<li>âœ… Lets you set start/stop thresholds (battery longevity)</li>
<li>âœ… Saves thresholds to <code>/etc/battery-manager/BAT*.conf</code> (simple text format)</li>
<li>âœ… Restores thresholds at boot via a systemd service</li>
<li>âœ… Writes to <code>/sys/class/power_supply/</code> (needs pkexec)</li>
<li>âœ… Detects peripheral batteries (wireless mouse/keyboard)</li>
</ul>
<hr />
<h2 id="installation">ğŸ“¦ Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="end-users-recommended">End users (recommended)<a class="headerlink" href="#end-users-recommended" title="Permanent link">&para;</a></h3>
<p>Full install with menu entry, icon, and systemd service:</p>
<pre><code class="language-bash">sudo dpkg -i battery-manager_0.9.8_amd64.deb
</code></pre>
<h3 id="developers">Developers<a class="headerlink" href="#developers" title="Permanent link">&para;</a></h3>
<p>Manual service install (no menu entry/icon):</p>
<pre><code class="language-bash">git clone https://github.com/weedmanu/Battery_Charge_Manager.git
cd Battery_Manager
cargo build --release
cd install
sudo ./install.sh
</code></pre>
<blockquote>
<p>Note: <code>install.sh</code> is developer-oriented. For a full user install, use the <code>.deb</code> package.</p>
</blockquote>
<hr />
<h2 id="usage">ğŸš€ Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Launch from the app menu or from a terminal:</p>
<pre><code class="language-bash">battery-manager
battery-manager --lang=fr
battery-manager --lang=en
battery-manager --debug
battery-manager --help

# Optional: force/disable log colors
BATTERY_MANAGER_COLOR=always battery-manager --debug
NO_COLOR=1 battery-manager --debug
</code></pre>
<h3 id="ui">UI<a class="headerlink" href="#ui" title="Permanent link">&para;</a></h3>
<p>The UI has <strong>4 tabs</strong>:</p>
<ul>
<li><strong>ğŸ“Š Information</strong>: charge/health/voltage/power/cycles</li>
<li><strong>ğŸ–±ï¸ Peripherals</strong>: external batteries (mouse/keyboard)</li>
<li><strong>âš™ï¸ Settings</strong>: thresholds, alarm, systemd toggle</li>
<li><strong>ğŸ¨ Interface</strong>: language + theme</li>
</ul>
<p>Thresholds are applied immediately. They are restored at the next boot only if the systemd service is enabled; otherwise, they will be lost after reboot.</p>
<hr />
<h2 id="scripts-behavior-important">ğŸ§© Scripts &amp; behavior (important)<a class="headerlink" href="#scripts-behavior-important" title="Permanent link">&para;</a></h2>
<h3 id="1-where-are-thresholds-stored">1) Where are thresholds stored?<a class="headerlink" href="#1-where-are-thresholds-stored" title="Permanent link">&para;</a></h3>
<p>Thresholds are saved as plain text files:</p>
<ul>
<li><code>/etc/battery-manager/BAT*.conf</code></li>
</ul>
<p>Expected format (example):</p>
<pre><code class="language-text">START_THRESHOLD=60
STOP_THRESHOLD=80
</code></pre>
<p>Notes:</p>
<ul>
<li><code>STOP_THRESHOLD</code> is required.</li>
<li><code>START_THRESHOLD</code> is <strong>optional</strong>: many laptops only support a stop/end threshold.</li>
</ul>
<h3 id="2-how-are-thresholds-restored-at-boot">2) How are thresholds restored at boot?<a class="headerlink" href="#2-how-are-thresholds-restored-at-boot" title="Permanent link">&para;</a></h3>
<p>The systemd service <code>battery-manager.service</code> runs a one-shot script:</p>
<ul>
<li><code>/usr/bin/battery-manager-restore</code></li>
</ul>
<p>It reads <code>/etc/battery-manager/*.conf</code> and writes to sysfs.</p>
<p>Start threshold (if set):</p>
<ul>
<li><code>/sys/class/power_supply/BAT*/charge_control_start_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_start_threshold</code></li>
</ul>
<p>Stop threshold:</p>
<ul>
<li><code>/sys/class/power_supply/BAT*/charge_control_end_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_stop_threshold</code></li>
<li><code>/sys/class/power_supply/BAT*/charge_end_threshold</code></li>
</ul>
<p>The script tries these paths in order and uses the first writable file it finds.</p>
<p>Useful commands:</p>
<pre><code class="language-bash">systemctl status battery-manager.service
sudo battery-manager-restore
journalctl -u battery-manager.service -b --no-pager
</code></pre>
<h3 id="3-what-are-the-scripts-in-install">3) What are the scripts in <code>install/</code>?<a class="headerlink" href="#3-what-are-the-scripts-in-install" title="Permanent link">&para;</a></h3>
<ul>
<li><code>install/install.sh</code>: installs <strong>binary + restore script + systemd service</strong> (dev mode, no menu/icon)</li>
<li><code>install/uninstall.sh</code>: removes those files (keeps <code>/etc/battery-manager/</code>)</li>
<li><code>install/build-deb.sh</code>: builds the <code>.deb</code> package (full end-user install)</li>
</ul>
<hr />
<h2 id="uninstall">ğŸ—‘ï¸ Uninstall<a class="headerlink" href="#uninstall" title="Permanent link">&para;</a></h2>
<pre><code class="language-bash">sudo apt remove battery-manager

cd Battery_Manager/install
sudo ./uninstall.sh
</code></pre>
<hr />
<h2 id="project-structure">ğŸ“‚ Project structure<a class="headerlink" href="#project-structure" title="Permanent link">&para;</a></h2>
<pre><code>Battery_Manager/                        # 7 directories, 16 files
â”œâ”€â”€ Cargo.toml                          # Rust deps (GTK4, serde)
â”œâ”€â”€ Cargo.lock                          # Locked dependency versions
â”œâ”€â”€ LICENSE                             # MIT
â”œâ”€â”€ README.md                           # Main documentation (Markdown)
â”œâ”€â”€ README.html                         # Main documentation (HTML)
â”œâ”€â”€ REFERENCES.md                       # References (Markdown)
â”œâ”€â”€ REFERENCES.html                     # References (HTML)
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ style.css                       # Modern docs CSS (menu + theme + FR/EN)
â”‚
â”œâ”€â”€ install/
â”‚   â”œâ”€â”€ build-deb.sh
â”‚   â”œâ”€â”€ install.sh
â”‚   â””â”€â”€ uninstall.sh
â”‚
â”œâ”€â”€ resources/
â”‚   â”œâ”€â”€ battery-manager.desktop
â”‚   â”œâ”€â”€ battery-manager-restore.sh
â”‚   â”œâ”€â”€ battery-manager.service
â”‚   â””â”€â”€ icon.png
â”‚
â””â”€â”€ src/                                # Rust source (2728 LOC, 17 files)
    â”œâ”€â”€ core/
    â”œâ”€â”€ ui/
    â””â”€â”€ main.rs
</code></pre>
<h3 id="code-stats">Code stats<a class="headerlink" href="#code-stats" title="Permanent link">&para;</a></h3>
<pre><code>Language                     files          blank        comment           code
-------------------------------------------------------------------------------
Rust                            17            453            578           2728
-------------------------------------------------------------------------------
</code></pre>
<hr />
<h2 id="requirements">ğŸ”§ Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h2>
<h3 id="end-users">End users<a class="headerlink" href="#end-users" title="Permanent link">&para;</a></h3>
<ul>
<li>Debian-based distro (Ubuntu/Mint/Pop!_OS, ...)</li>
<li>GTK4 deps are installed via the <code>.deb</code></li>
<li>pkexec (PolicyKit)</li>
<li>Hardware/kernel support for charge thresholds</li>
</ul>
<h3 id="developers_1">Developers<a class="headerlink" href="#developers_1" title="Permanent link">&para;</a></h3>
<pre><code class="language-bash">curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
sudo apt install libgtk-4-dev build-essential policykit-1
</code></pre>
<hr />
<h2 id="compatibility">âœ… Compatibility<a class="headerlink" href="#compatibility" title="Permanent link">&para;</a></h2>
<p>Works on laptops exposing threshold controls via <code>/sys/class/power_supply/BAT*/</code>.</p>
<p>Supported sysfs names:</p>
<ul>
<li><code>charge_control_start_threshold</code> / <code>charge_control_end_threshold</code></li>
<li><code>charge_start_threshold</code> / <code>charge_stop_threshold</code></li>
<li><code>charge_end_threshold</code></li>
</ul>
<hr />
<h2 id="limitations">âš ï¸ Limitations<a class="headerlink" href="#limitations" title="Permanent link">&para;</a></h2>
<ul>
<li>Requires proper hardware/kernel support</li>
<li>Some vendors expose only one threshold</li>
<li>Language change requires restarting the app</li>
</ul>
<hr />
<h2 id="tests">ğŸ§ª Tests<a class="headerlink" href="#tests" title="Permanent link">&para;</a></h2>
<pre><code class="language-bash">cargo test
cargo test --test-threads=1
</code></pre>
<p>Expected:</p>
<pre><code class="language-text">test result: ok. 40 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
</code></pre>
<hr />
<h2 id="aaa-quality">ğŸ† AAA Quality<a class="headerlink" href="#aaa-quality" title="Permanent link">&para;</a></h2>
<pre><code class="language-bash">cargo fmt
cargo clippy --all-features --all-targets -- -W clippy::pedantic -W clippy::nursery
cargo build --release
</code></pre>
<hr />
<h2 id="license">ğŸ“„ License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h2>
<p>MIT â€” see <a href="LICENSE">LICENSE</a></p></div>
      </main>
    </div>
  </div>
</body>
</html>
